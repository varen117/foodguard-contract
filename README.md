# é£Ÿå“å®‰å…¨æ²»ç†åˆçº¦ç³»ç»Ÿ (FoodGuard Contract)

![Solidity](https://img.shields.io/badge/Solidity-^0.8.20-363636?style=flat-square&logo=solidity)
![Foundry](https://img.shields.io/badge/Foundry-Framework-red?style=flat-square)
![License](https://img.shields.io/badge/License-MIT-green?style=flat-square)

ä¸€ä¸ªåŸºäºåŒºå—é“¾çš„é£Ÿå“å®‰å…¨æ²»ç†ç³»ç»Ÿï¼Œé€šè¿‡å»ä¸­å¿ƒåŒ–æ–¹å¼å¤„ç†é£Ÿå“å®‰å…¨æŠ•è¯‰ï¼Œå®ç°é€æ˜ã€å…¬æ­£çš„äº‰è®®è§£å†³æœºåˆ¶ã€‚

## ğŸ¯ é¡¹ç›®æ„¿æ™¯

è§£å†³ä¼ ç»Ÿé£Ÿå“å®‰å…¨æŠ•è¯‰å¤„ç†ä¸­çš„ç—›ç‚¹ï¼š
- **ä¸é€æ˜**ï¼šä¼ ç»Ÿæµç¨‹ç¼ºä¹é€æ˜åº¦ï¼Œç”¨æˆ·æ— æ³•è·Ÿè¸ªå¤„ç†è¿›åº¦
- **ç›‘ç®¡ä¸åŠ›**ï¼šç¼ºä¹æœ‰æ•ˆçš„ç›‘ç£æœºåˆ¶å’Œç¬¬ä¸‰æ–¹éªŒè¯
- **èµ”å¿å›°éš¾**ï¼šäº‰è®®è§£å†³å‘¨æœŸé•¿ï¼Œèµ”å¿æœºåˆ¶ä¸å®Œå–„
- **ä¿¡ä»»ç¼ºå¤±**ï¼šä¼ä¸šå’Œæ¶ˆè´¹è€…ä¹‹é—´ç¼ºä¹å¯ä¿¡çš„ä»²è£æœºåˆ¶

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ ¸å¿ƒæ¨¡å—

```
FoodSafetyGovernance (ä¸»åˆçº¦)
â”œâ”€â”€ FundManager (èµ„é‡‘ç®¡ç†)
â”œâ”€â”€ VotingManager (æŠ•ç¥¨ç®¡ç†) 
â”œâ”€â”€ DisputeManager (è´¨ç–‘ç®¡ç†)
â””â”€â”€ RewardPunishmentManager (å¥–æƒ©ç®¡ç†)
```

### æ•°æ®ç»“æ„åº“
- **DataStructures.sol**: ç»Ÿä¸€æ•°æ®ç»“æ„å®šä¹‰
- **Errors.sol**: è‡ªå®šä¹‰é”™è¯¯ç±»å‹
- **Events.sol**: äº‹ä»¶å®šä¹‰

## ğŸ”„ æ²»ç†æµç¨‹

ç³»ç»Ÿä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹æµç¨‹å›¾å®ç°ï¼š

```
æŠ•è¯‰åˆ›å»º â†’ ä¿è¯é‡‘é”å®š â†’ éªŒè¯è€…æŠ•ç¥¨ â†’ è´¨ç–‘æœŸ â†’ å¥–æƒ©åˆ†é… â†’ æ¡ˆä»¶å®Œç»“
```

### è¯¦ç»†æµç¨‹

1. **æŠ•è¯‰é˜¶æ®µ**: ç”¨æˆ·åˆ›å»ºæŠ•è¯‰ï¼Œæäº¤è¯æ®å’Œä¿è¯é‡‘
2. **é”å®šé˜¶æ®µ**: ç³»ç»Ÿé”å®šåŒæ–¹ä¿è¯é‡‘ï¼Œé˜²æ­¢æ¶æ„è¡Œä¸º
3. **æŠ•ç¥¨é˜¶æ®µ**: éšæœºé€‰æ‹©éªŒè¯è€…è¿›è¡ŒæŠ•ç¥¨éªŒè¯
4. **è´¨ç–‘é˜¶æ®µ**: å…è®¸å¯¹æŠ•ç¥¨ç»“æœæå‡ºè´¨ç–‘
5. **å¥–æƒ©é˜¶æ®µ**: æ ¹æ®æœ€ç»ˆç»“æœåˆ†é…å¥–åŠ±å’Œæƒ©ç½š
6. **å®Œç»“é˜¶æ®µ**: æ¡ˆä»¶ç»“æŸï¼Œèµ„é‡‘é‡Šæ”¾

## ğŸ’° ç»æµæ¨¡å‹

### ä¿è¯é‡‘æœºåˆ¶
- **æŠ•è¯‰ä¿è¯é‡‘**: 0.1 ETH (é˜²æ­¢æ¶æ„æŠ•è¯‰)
- **ä¼ä¸šä¿è¯é‡‘**: 1.0 ETH (ç¡®ä¿ä¼ä¸šå‚ä¸)
- **è´¨ç–‘ä¿è¯é‡‘**: 0.05 ETH (è´¨ç–‘éªŒè¯è€…å†³å®š)

### èµ„é‡‘åˆ†é…
- **å¥–åŠ±æ± **: 70% (æ¿€åŠ±è¯šå®å‚ä¸)
- **è¿è¥è´¹ç”¨**: 10% (ç³»ç»Ÿç»´æŠ¤)
- **å‚¨å¤‡é‡‘**: 20% (é£é™©æ§åˆ¶)

## ğŸ› ï¸ æŠ€æœ¯ç‰¹æ€§

### å®‰å…¨è®¾è®¡
- âœ… **é‡å…¥é˜²æŠ¤**: é˜²æ­¢é‡å…¥æ”»å‡»
- âœ… **è®¿é—®æ§åˆ¶**: åŸºäºè§’è‰²çš„æƒé™ç®¡ç†
- âœ… **æš‚åœæœºåˆ¶**: ç´§æ€¥æƒ…å†µä¸‹å¯æš‚åœåˆçº¦
- âœ… **Gasä¼˜åŒ–**: ä½¿ç”¨ `via_ir` ç¼–è¯‘ä¼˜åŒ–

### æ¨¡å—åŒ–æ¶æ„
- âœ… **èŒè´£åˆ†ç¦»**: æ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šåŠŸèƒ½
- âœ… **å¯å‡çº§æ€§**: æ”¯æŒæ¨¡å—ç‹¬ç«‹å‡çº§
- âœ… **äº‹ä»¶è¿½è¸ª**: å®Œæ•´çš„æ“ä½œæ—¥å¿—è®°å½•

### æ•°æ®å®Œæ•´æ€§
- âœ… **çŠ¶æ€æœº**: ä¸¥æ ¼çš„çŠ¶æ€æµè½¬æ§åˆ¶
- âœ… **æ•°æ®éªŒè¯**: å…¨é¢çš„è¾“å…¥éªŒè¯æœºåˆ¶
- âœ… **é”™è¯¯å¤„ç†**: è¯¦ç»†çš„é”™è¯¯ç±»å‹å®šä¹‰

## ğŸ“‹ å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ
- [x] å®Œæ•´çš„åˆçº¦æ¶æ„è®¾è®¡
- [x] æ‰€æœ‰æ ¸å¿ƒæ¨¡å—å®ç°
- [x] æ•°æ®ç»“æ„å’Œäº‹ä»¶å®šä¹‰
- [x] ç¼–è¯‘æˆåŠŸ (è§£å†³æ ˆæ·±åº¦é—®é¢˜)
- [x] åŸºç¡€åŠŸèƒ½æµ‹è¯• (4/10 æµ‹è¯•é€šè¿‡)
- [x] éƒ¨ç½²è„šæœ¬å’Œé…ç½®

### ğŸ”„ è¿›è¡Œä¸­
- [ ] ä¿®å¤æŠ•è¯‰åˆ›å»ºä¸­çš„ç®—æœ¯æº¢å‡ºé—®é¢˜
- [ ] å®Œå–„éªŒè¯è€…æ³¨å†Œå’Œé€‰æ‹©æœºåˆ¶
- [ ] è´¨ç–‘ç³»ç»Ÿçš„è¯¦ç»†å®ç°

### ğŸ“‹ å¾…å®Œæˆ
- [ ] å®Œæ•´çš„å•å…ƒæµ‹è¯•è¦†ç›–
- [ ] é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•
- [ ] Gas ä¼˜åŒ–å’Œæ€§èƒ½è°ƒä¼˜
- [ ] å®‰å…¨å®¡è®¡å’Œæ¼æ´ä¿®å¤
- [ ] å‰ç«¯ç•Œé¢å¼€å‘

## ğŸ§ª æµ‹è¯•ç»“æœ

```bash
Running 10 tests...
âœ… test_AdminFunctions() - ç®¡ç†å‘˜åŠŸèƒ½æµ‹è¯•
âœ… test_ReentrancyProtection() - é‡å…¥é˜²æŠ¤æµ‹è¯•  
âœ… test_UserRegistration() - ç”¨æˆ·æ³¨å†Œæµ‹è¯•
âœ… test_UserRegistrationFailures() - æ³¨å†Œå¤±è´¥æµ‹è¯•
âŒ test_ComplaintCreation() - æŠ•è¯‰åˆ›å»ºæµ‹è¯• (ç®—æœ¯æº¢å‡º)
âŒ test_CompleteComplaintFlow() - å®Œæ•´æµç¨‹æµ‹è¯• (ç®—æœ¯æº¢å‡º)
... (å…¶ä»–æµ‹è¯•)

é€šè¿‡ç‡: 40% (4/10)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- **Foundry**: æœ€æ–°ç‰ˆæœ¬
- **Solidity**: >= 0.8.20
- **Node.js**: >= 16.0.0

### å®‰è£…ä¸ç¼–è¯‘

```bash
# å…‹éš†é¡¹ç›®
git clone [repository-url]
cd foodguard-contract

# å®‰è£…ä¾èµ–
forge install

# ç¼–è¯‘åˆçº¦
make build

# è¿è¡Œæµ‹è¯•
make test

# éƒ¨ç½²åˆ°æœ¬åœ°ç½‘ç»œ
make deploy-local
```

### é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
PRIVATE_KEY=your_private_key
SEPOLIA_RPC_URL=your_sepolia_rpc_url
ETHERSCAN_API_KEY=your_etherscan_api_key
```

## ğŸ“š åˆçº¦æ¥å£

### ä¸»è¦å‡½æ•°

```solidity
// ç”¨æˆ·æ³¨å†Œ
function registerUser() external payable
function registerEnterprise() external payable

// æŠ•è¯‰æµç¨‹
function createComplaint(...) external payable returns (uint256 caseId)
function endVotingAndStartChallenge(uint256 caseId) external
function endChallengeAndProcessRewards(uint256 caseId) external

// æŸ¥è¯¢å‡½æ•°
function getCaseInfo(uint256 caseId) external view returns (CaseInfo memory)
function getTotalCases() external view returns (uint256)
```

## ğŸ”§ å¼€å‘å·¥å…·

### Makefile å‘½ä»¤

```bash
make build          # ç¼–è¯‘åˆçº¦
make test           # è¿è¡Œæµ‹è¯•
make test-v         # è¯¦ç»†æµ‹è¯•è¾“å‡º
make clean          # æ¸…ç†æ„å»ºæ–‡ä»¶
make deploy-local   # éƒ¨ç½²åˆ°æœ¬åœ°ç½‘ç»œ
make deploy-sepolia # éƒ¨ç½²åˆ° Sepolia æµ‹è¯•ç½‘
```

## ğŸ“ˆ Gas æ¶ˆè€—åˆ†æ

| æ“ä½œ | Gas æ¶ˆè€— | ä¼˜åŒ–çŠ¶æ€ |
|------|----------|----------|
| ç”¨æˆ·æ³¨å†Œ | ~175K | âœ… å·²ä¼˜åŒ– |
| ä¼ä¸šæ³¨å†Œ | ~98K | âœ… å·²ä¼˜åŒ– |
| æŠ•è¯‰åˆ›å»º | ~TBD | ğŸ”„ ä¼˜åŒ–ä¸­ |
| æŠ•ç¥¨æäº¤ | ~TBD | ğŸ“‹ å¾…æµ‹è¯• |

## ğŸ›¡ï¸ å®‰å…¨è€ƒè™‘

### å·²å®ç°çš„å®‰å…¨æªæ–½
- **é‡å…¥é˜²æŠ¤**: ä½¿ç”¨ OpenZeppelin çš„ ReentrancyGuard
- **è®¿é—®æ§åˆ¶**: åŸºäºè§’è‰²çš„æƒé™ç®¡ç†
- **è¾“å…¥éªŒè¯**: å…¨é¢çš„å‚æ•°éªŒè¯
- **æ•´æ•°æº¢å‡º**: Solidity 0.8+ å†…ç½®ä¿æŠ¤

### é£é™©è¯„ä¼°
- **æ²»ç†æ”»å‡»**: é€šè¿‡ç»æµæ¿€åŠ±å’Œå£°èª‰æœºåˆ¶ç¼“è§£
- **å¥³å·«æ”»å‡»**: é€šè¿‡ä¿è¯é‡‘æœºåˆ¶é˜²èŒƒ
- **å…±è°‹è¡Œä¸º**: é€šè¿‡éšæœºé€‰æ‹©éªŒè¯è€…é™ä½é£é™©

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿ç¤¾åŒºè´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤å˜æ›´ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

### ä»£ç è§„èŒƒ
- éµå¾ª Solidity æ ·å¼æŒ‡å—
- æ·»åŠ è¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Š
- ç¼–å†™ç›¸åº”çš„å•å…ƒæµ‹è¯•
- ç¡®ä¿ Gas ä¼˜åŒ–

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ“ è”ç³»æ–¹å¼

- **é¡¹ç›®ç»´æŠ¤è€…**: Food Safety Governance Team
- **æŠ€æœ¯æ”¯æŒ**: [GitHub Issues](../../issues)
- **æ–‡æ¡£**: [é¡¹ç›®æ–‡æ¡£](./docs/)

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºé£Ÿå“å®‰å…¨æ²»ç†äº‹ä¸šåšå‡ºè´¡çŒ®çš„å¼€å‘è€…å’Œç¤¾åŒºæˆå‘˜ã€‚è®©æˆ‘ä»¬å…±åŒæ„å»ºä¸€ä¸ªæ›´å®‰å…¨ã€æ›´é€æ˜çš„é£Ÿå“å®‰å…¨ç”Ÿæ€ç³»ç»Ÿï¼

---

*æ­¤é¡¹ç›®æ­£åœ¨ç§¯æå¼€å‘ä¸­ï¼Œæ¬¢è¿åé¦ˆå’Œå»ºè®®ï¼* ğŸš€
